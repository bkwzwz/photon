From 8c9043b8e84dd079603b83ba4c6b4bdce8063ce3 Mon Sep 17 00:00:00 2001
From: Ankit Jain <ankitja@vmware.com>
Date: Mon, 4 May 2020 12:11:24 +0530
Subject: [PATCH] docker: Fix for CVE-2019-16884

- Updated runc and containerd version to fix the CVE
- Refered and back-ported Upstream commit:
 - https://github.com/docker/engine/pull/386/files

Change-Id: Idafb935452d5867427118d0f8814bb0cb92b402a
Signed-off-by: Ankit Jain <ankitja@vmware.com>
---
 ...pdate-runc-containerd-CVE-2019-16884.patch | 38 +++++++++++++++++++
 1 file changed, 38 insertions(+)
 create mode 100644 SPECS/docker/update-runc-containerd-CVE-2019-16884.patch

diff --git a/hack/dockerfile/install/containerd.installer b/hack/dockerfile/install/containerd.installer
index dceae49..ec87325 100755
--- a/hack/dockerfile/install/containerd.installer
+++ b/hack/dockerfile/install/containerd.installer
@@ -4,7 +4,7 @@
 # containerd is also pinned in vendor.conf. When updating the binary
 # version you may also need to update the vendor version to pick up bug
 # fixes or new APIs.
-CONTAINERD_COMMIT=468a545b9edcd5932818eb9de8e72413e616e86e # v1.1.2
+CONTAINERD_COMMIT=b34a5c8af56e510852c35414db4c1f4fa6172339 # v1.2.10
 
 install_containerd() {
 	echo "Install containerd version $CONTAINERD_COMMIT"
diff --git a/hack/dockerfile/install/runc.installer b/hack/dockerfile/install/runc.installer
index 3508ed9..c7dd742 100755
--- a/hack/dockerfile/install/runc.installer
+++ b/hack/dockerfile/install/runc.installer
@@ -1,9 +1,7 @@
 #!/bin/sh
 
 # When updating RUNC_COMMIT, also update runc in vendor.conf accordingly
-RUNC_COMMIT=69663f0bd4b60df09991c08812a60108003fa340
-RUNC_OVERRIDE_COMMIT=a592beb5bc4c4092b1b1bac971afed27687340c5
-RUNC_BUNDLE=/go/src/github.com/docker/docker/git-bundles/CVE-2019-5736.bundle
+RUNC_COMMIT=3e425f80a8c931f88e6d94a8c831b9d5aa481657 # v1.0.0-rc8-92-g84373aaa
 
 install_runc() {
 	# Do not build with ambient capabilities support
@@ -31,8 +29,7 @@ install_runc() {
 		target="$1"
 	fi
 
-	OVERRIDE_VERSION="1.0.0-rc5+dev.docker-18.06"
-	make BUILDTAGS="$RUNC_BUILDTAGS" COMMIT="$RUNC_COMMIT" VERSION="$OVERRIDE_VERSION" "$target"
+	make BUILDTAGS="$RUNC_BUILDTAGS" COMMIT="$RUNC_COMMIT" "$target"
 	mkdir -p ${PREFIX}
 	cp runc ${PREFIX}/docker-runc
 }
